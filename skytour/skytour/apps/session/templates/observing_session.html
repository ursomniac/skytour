{% extends 'base.html' %}
{% load skytour_filters humanize %}
{% block content %}
<style>
.plan td {
    vertical-align: top;
    padding: 1em;
}
table .inner {
  border: 0;
  padding: 0 0;
}
td {
  border: 0; padding: 0 1em;
}

.td-center td {
  vertical-align: middle;
}
details {
  user-select: none;
}

details>summary span.icon {
  width: 24px;
  height: 24px;
  transition: all 0.3s;
  margin-left: auto;
}

details[open] summary span.icon {
  transform: rotate(180deg);
}

summary {
  display: flex;
  cursor: pointer;
  background-color: #666;
  color: #fff;
  padding: 4px 10px;
  margin: 0px 10px 20px 10px;
}

summary::-webkit-details-marker {
  display: none;
}
</style>

<h1>Plan Observations</h1>
<h2>Current UT: {{ now|date:"D Y-M-d H:i" }}</h2>
<div class="plan_form">
    {% if form %}
    <form method="post">
        {% csrf_token %}
        <table>
            {{ form.as_table }}
        </table>
        <br><input type="submit" value="Submit"/>
        <br><small>This can take up to a minute to run.</small>
    </form>
    {% else %}
    There is no form!
    {% endif %}
</div>

{% if has_plan %}
<table><tr>
  <td>Jump to:</td>
  <td><a href="#moon">Moon</a></td>
    <td><a href="#planets">Planets</a></td>
    <td><a href="#asteroids">Asteroids</a></td>
    <td><a href="#dso">DSO</a></td>
</tr></table>
  <h2>Observing Plan</h2>

  <table class="plan">
      <tr>
          <th>Session</th>
          <th>Almanac</th>
      </tr>
      <tr>
          <td>
              Start: {{ plan.utdt_start|date:"D Y M d  H:i"}} UT<br/>
              End: {{ plan.utdt_end|date:"D Y M d  H:i"}} UT<br/><br/>
              Julian Date: {{ plan.julian_date|floatformat:5 }}
          </td>
          <td>
              Twilight Ends: {{ plan.twilight_end|date:"D Y M d H:i" }} UT <br/>
              Twilight Begins: {{ plan.twilight_begin|date:"D Y M d H:i" }} UT
          </td>
      </tr>
  </table>

<a name="moon"></a>
  {% with object=plan.moon object_type='moon' show_object=plan.show_moon %}{% include 'inc_object_header.html' %}{% endwith %}
  {% if plan.show_moon %}
  {% with plan.moon as object %}{% include 'includes/solar_system_object.html' %}{% endwith %}
  {% endif %}

<a name="planets"></a>
  <h2>Planets</h2>
  {% for planet in plan.planets %}
    {% with object=planet object_type='planet' show_object=planet.show_planet %}{% include 'inc_object_header.html' %}{% endwith %}
    {% if planet.show_planet %}
      {% with planet as object %}{% include 'includes/solar_system_object.html' %}{% endwith %}
    {% endif %}
    <br>
  {% endfor %}

<a name="asteroids"></a>
  <h2>Bright Asteroids</h2>
  {% for key, asteroid in plan.asteroids %}
    {% with object=asteroid object_type='asteroid' show_object=asteroid.show_asteroid %}{% include 'inc_object_header.html' %}{% endwith %}
    {% if asteroid.show_asteroid %}
      {% with asteroid as object %}{% include 'includes/solar_system_object.html' %}{% endwith %}
    {% endif %}
    <br>
  {% endfor %}

<a name="dso"></a>
  <h2>DSO Targets</h2>
  <details>
    <summary>
      <h3>Highest Priority ({{ plan.dso_targets.highest|length }} DSOs)</h3>
      <span class="icon">ðŸ‘‡</span>
    </summary>
    {% with dso_list=plan.dso_targets.highest table_id='highest-dsos' %}
    {% include 'includes/dso_table.html' %}
    {% endwith %}
  </details>

  <details>
    <summary>
      <h3>High Priority ({{ plan.dso_targets.high|length }} DSOs)</h3>
      <span class="icon">ðŸ‘‡</span>
    </summary>
    {% with dso_list=plan.dso_targets.high table_id='high-dsos' %}
    {% include 'includes/dso_table.html' %}
    {% endwith %}
  </details>

  <details>
    <summary>
    <h3>Medium Priority ({{ plan.dso_targets.medium|length }} DSOs)</h3>
    <span class="icon">ðŸ‘‡</span>
    </summary>
    {% with dso_list=plan.dso_targets.medium table_id='medium-dsos' %}
    {% include 'includes/dso_table.html' %}
    {% endwith %}
  </details>

  <details>
    <summary>
    <h3>Low Priority ({{ plan.dso_targets.low|length }} DSOs)</h3>
    <span class="icon">ðŸ‘‡</span>
    </summary>
    {% with dso_list=plan.dso_targets.low table_id='low-dsos' %}
    {% include 'includes/dso_table.html' %}
    {% endwith %}
  </details>
{% endif %}
{% endblock %}